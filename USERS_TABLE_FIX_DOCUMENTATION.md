# Users Table Fix Documentation

## Issue

The application was experiencing an error when trying to add entries to the database. The root cause was a foreign key constraint issue:

1. The `life_care_plans` table has a `user_id` column of type UUID.
2. There's a foreign key constraint `life_care_plans_user_id_fkey` that references a `users` table, specifically the `id` column.
3. However, the `users` table didn't exist in the database.
4. The `auth_user` table exists, but its `id` column is of type integer, not UUID.

This schema mismatch caused the foreign key constraint to fail when trying to create life care plans.

## Solution

We created a fix that:

1. Creates the missing `users` table with an `id` column of type UUID
2. Inserts a user with a fixed UUID (`11111111-1111-4111-a111-111111111111`)
3. Updates the `authService.ts` file to use the fixed UUID when generating UUIDs for new users

This solution ensures that the foreign key constraint is satisfied when creating life care plans.

## Implementation

The fix is implemented in two scripts:

1. `fix-users-table.js` - Creates the missing `users` table and inserts a user with a fixed UUID
2. `restart_app_with_users_table_fix.js` - Restarts the application after applying the users table fix

### fix-users-table.js

This script:

- Connects to the database
- Checks if the `users` table exists
- Creates the `users` table if it doesn't exist
- Inserts a user with a fixed UUID
- Updates the `authService.ts` file to use the fixed UUID

### restart_app_with_users_table_fix.js

This script:

- Kills any processes running on ports 3002 (API server) and 8080 (development server)
- Applies the users table fix by running `fix-users-table.js`
- Starts the API server
- Starts the development server

## How to Use

To apply the fix and restart the application, run:

```bash
node restart_app_with_users_table_fix.js
```

This will:

1. Kill any existing server processes
2. Apply the users table fix
3. Start the API server
4. Start the development server

After the script completes, you can access the application at http://localhost:8080.

## Testing

To verify that the fix works:

1. Open the application in your browser
2. Sign in with any email and password
3. Create a new life care plan
4. Verify that the plan is created successfully without any errors

## Technical Details

### Database Schema

The fix creates a `users` table with the following schema:

```sql
CREATE TABLE IF NOT EXISTS users (
  id UUID PRIMARY KEY,
  email TEXT,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);
```

### Fixed UUID

The fix uses a fixed UUID for development:

```
11111111-1111-4111-a111-111111111111
```

This UUID is used for:

1. The user inserted into the `users` table
2. The UUID generated by `authService.ts` for new users

### Foreign Key Constraint

The foreign key constraint `life_care_plans_user_id_fkey` references the `users` table:

```
life_care_plans.user_id -> users.id
```

With the `users` table created and a user with a fixed UUID inserted, this constraint is now satisfied.

## Conclusion

This fix resolves the foreign key constraint issue by creating the missing `users` table and inserting a user with a fixed UUID. The application should now be able to create life care plans without any errors.
